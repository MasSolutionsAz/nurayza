$(document).ready(function () {
    $slider_range = $("#slider-range"), $(".hero-slider ").owlCarousel({
        items: 1,
        nav: !1,
        dots: !0,
        autoplay: !0,
        loop: false,
        autoplayTimeout: 1e4,
        animateOut: "slideOutRight",
        animateIn: "slideInRight"
    });
    let showArrows = false;
    if (document.querySelector('.popular-product-slider')) {

        if (screen.width > 1000) {
            let sliderItms = document.querySelector('.popular-product-slider .owl-stage-outer .owl-stage') || document.querySelector(".popular-product-slider");
            if (sliderItms.children.length > 4) {
                showArrows = true;
            }
            else showArrows = false;
        }

        else if (screen.width > 576 && screen.width <= 1000) {
            let sliderItms = document.querySelector('.popular-product-slider .owl-stage-outer .owl-stage') || document.querySelector(".popular-product-slider");
            if (sliderItms.children.length > 3) {
                showArrows = true;
            }
            else showArrows = false;
        }

        else if (screen.width > 300 && screen.width <= 576) {
            let sliderItms = document.querySelector('.popular-product-slider .owl-stage-outer .owl-stage') || document.querySelector(".popular-product-slider");
            if (sliderItms.children.length > 2) {
                showArrows = true;
            }
            else showArrows = false;
        }

        else if (screen.width <= 300) {
            let sliderItms = document.querySelector('.popular-product-slider .owl-stage-outer .owl-stage') || document.querySelector(".popular-product-slider");
            if (sliderItms.children.length > 1) {
                showArrows = true;
            }
            else showArrows = false;
        }
    }

    $(".popular-product-slider").owlCarousel({
        items: 4,
        nav: !0,
        dots: !0,
        navText: ["<img src='/static/img/prev2.png'>", "<img src='/static/img/next2.png'>"],
        responsiveClass: true,
        responsive: {
            0: {
                items: 1,
                nav: showArrows
            },
            300: {
                items: 2,
                nav: showArrows
            },
            576: {
                items: 3,
                nav: showArrows
            },
            1000: {
                items: 4,
                nav: showArrows,
                loop: false
            }
        }
    });

    $(".show-search-box").on("click", function (A) {
        A.preventDefault(), $(".search-box").fadeToggle();
    });
    $(".show-basket-box").on("click", function (A) {
        A.preventDefault(), $(".basket-box").fadeToggle();
    });
    $(".show-basket-box, .navbar-toggler img").on("click", function (A) {
        A.preventDefault(), $(".search-box").fadeOut();
    });
    $(".hide-basket-box, .show-search-box, .navbar-toggler img").on("click", function (A) {
        A.preventDefault(), $(".basket-box").fadeOut();
    });
    $("footer select, header #language").niceSelect();
    $slider_range.length && ($max = $(".max-price").data("max"), $min = $(".min-price").data("min"), $slider_range.slider({
        range: !0,
        min: $min,
        max: $max,
        slide: function (A, w) {
            let priceClass = '';
            if (w.handleIndex === 0) priceClass = ".min-price";
            if (w.handleIndex === 1) priceClass = ".max-price";
            $(priceClass).val(w.value);
            $(priceClass).trigger('change');
        }
    }));
    $(".show-address-form").on("click", function (A) {
        A.preventDefault();
        $(".add-address").hide(), $(".address-form").fadeIn()
    });


    ! function () {
        if ($("#location-box").length != 1 && $(".location").length != 1) {
            return;
        }
        var A, w, e = [
            ['I Love Baku<br>          Üzeyir Hacıbəyov küçəsi 14, Bakı, Azərbaycan<br>         <a href="https://goo.gl/maps/cjWTm2s4EWGg5jHu9">Get Directions</a>', 40.3713156, 49.8420927],
            ['I Love Baku<br>          Heydər Əliyev prospekti 1, 1033<br>         <a href="https://goo.gl/maps/DiDu5s2twm8SAWKG6">Get Directions</a>', 40.3988097, 49.8734274]
        ],
            a = new google.maps.Map(document.getElementById("location-box"), {
                zoom: 13,
                center: {
                    lat: 40.38,
                    lng: 49.848
                },
                styles: [{
                    stylers: [{
                        saturation: -100
                    }]
                }]
            }),
            o = new google.maps.InfoWindow({});
        for (w = 0; w < e.length; w++) A = new google.maps.Marker({
            position: new google.maps.LatLng(e[w][1], e[w][2]),
            map: a,
            title: e[w][0],
            icon: "data:image/jpeg;base64, iVBORw0KGgoAAAANSUhEUgAAABgAAAAeCAYAAAA2Lt7lAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMbSURBVEhLrdZLbA1RGMDxSyn1aks1WhqvNkEa70YEESGWYsWiItZiY9WdjZCIWgjCRmyEhHRBUikJNtINxULiLSlpPEqb6oOqqv//3jNMem9vtfolv87MnTPn+Z2ZjksMEQOJxBQOhViGdViEXDxDA56jmwp+cRxZUHkJ9uE2OtCHgZjPuIAqTAiPDR8UHo8lOI5WxCsd7AcasCo8nj0oOA5zcAJtyFTpYL2ow8xQzdBBoenYj9f4hagSz/uDeOWRdmwL1aTF+HA0VqMa8xEtfhdu4hAO4jy6EY98bEmdDhH0oBhH0YWoZ46kGnmhWDK4tmw94gt/MdxOD266sJvQhGhqmrEDGTOE3ytxD9G0nQm30sIpspJKmOdOzVecwg0ufnLMFM24AafLffACGcMGJmElpqEfjajLUrlhOSvvg+v0EBnDBiZjDRzJN1zDe2SLIlRhOjpRzjQVIUqOv8GPy+FudS7duSuQXjAE91yz7XgMF/onOvEMh1GBv9nJxS64YcygI5gVbmUNyuXAXX8W3YgyqgUH4MwkC9bAbDAtd2Ni8sY/BuWnohbxzenms94cC5wMPzZifXhuRMFz8+ALMGpAr1DuXJWmyiRag9FEC+6nTv9EGTbYwGyYdm0wI0YcZIQdfJu6+hNO9UYb8F3Si3b8wGhjQThGYSaW2YBfLkfQg2ybK2PQ9Vxs5TTTG7XFBtzJDtFdaSb4QCH8NpRiNgqQh4kwPS2TD3u9E7Wwrnj4ymnwI/OGE3fmZVzBXPheKoHfYHe36/MFPuQ02inXbinWogLxF+N3XEeNDTzlZDE+4BMK4Lq4UVwoH3R0rpN8udlbG5+K+L6hukQH7uE07tjAA058F9mzd7gFG/V6BorhqOxlOaw0B9GUWKlraOMvcRX1nrPKPTbgvyAu0F0cQxOcFh+ykqi3UY9taCH8DjtVjs6R+2+M022qd4bUTf49hzfYg4wfmP8Je/cIH/GEVkecpsOFDTglrrop6OYY07ABt7gZ5GbxX8UxDRswrS7BTNrLKMa0keSUhKlxc22G2XGVH/yw/2ckEr8BbfZ1ny+ORP8AAAAASUVORK5CYII="
        }), google.maps.event.addListener(A, "click", function (A, w) {
            return function () {
                o.setContent(e[w][0]), o.open(a, A)
            }
        }(A, w))
    }()

    var aaa = setInterval(function () {
        if ($('.gmnoprint .gm-style-cc > div').length == 2) {
            clearInterval(aaa);
            $('.gmnoprint .gm-style-cc > div').remove();
        };
    }, 100)

    // height categories in product pages
    function heightFilter() {
        var heightElement = $(".filter-checkbox .head-checkbox").height();
        $(".filter-checkbox").css("height", heightElement + 25);
        $(".filter-checkbox").first().removeAttr("style").css("margin-bottom", "0").children(".head-checkbox").children("img").css("transform", "rotate(0deg)");
    }
    heightFilter();

    // shorten-extend filter chotlets in product pages
    $(".filter-checkbox .head-checkbox img").click(function () {
        var heightElement = $(this).parents(".head-checkbox").next().height();
        var heightElement1 = $(this).parents(".head-checkbox").height();
        if ($(this).parents(".filter-checkbox").height() > 60) {
            $(this).parents(".filter-checkbox").animate({ height: heightElement1 + 25, marginBottom: 25 });
            $(this).css("transform", "rotate(180deg)");
        } else {
            // $(".filter-checkbox").animate({ height: heightElement1 + 25, marginBottom: 25 }, "fast").children(".head-checkbox").children("img").css("transform", "rotate(180deg)");
            $(this).parents(".filter-checkbox").animate({ height: heightElement + heightElement1 + 60, marginBottom: 0 });
            $(this).css("transform", "rotate(0deg)");
        }
    })

    //show-hidden filter chotlest in product page
    $(".clothing .filter-clothing .toggle-filter").click(function () {
        if ($(document).width() > 576) {
            $(".clothing .filter-clothing, .clothing .result-clothing").toggleClass("active");
            if ($(this).hasClass("active")) {
                $(".result-clothing .clothing-item").parent().removeClass("col-lg-4 col-md-6").addClass("col-lg-3 col-md-4");
                $(".filter-clothing").css("z-index", "auto");
                $(".result-clothing").css("z-index", "30");
            } else {
                $(".result-clothing .clothing-item").parent().removeClass("col-lg-4 col-md-4").addClass("col-lg-4 col-md-6");
                setTimeout(function () {
                    $(".filter-clothing").css("z-index", "31");
                    $(".result-clothing").css("z-index", "auto");
                }, 500);
            }
        }
        else {
            $(".result-clothing .clothing-item").parent().removeClass("col-lg-4 col-md-6").addClass("col-lg-3 col-md-4");
            if ($(this).hasClass("active")) {
                $(".filter-clothing").css("z-index", "auto");
                $(".result-clothing").css("z-index", "30")
            } else {
                $(".result-clothing").addClass("bg");
                $(".filter-clothing").css("z-index", "31");
                $(".result-clothing").css("z-index", "auto");
            }
            $(".clothing .filter-clothing").toggleClass("active");
            $(".clothing .result-clothing").addClass("active");
        }
        $(this).toggleClass("active");
    });

    $("#image-popup .owl-carousel").owlCarousel({
        items: 1,
        nav: true
    });

    //write slogan with animate
    function animateSlogan() {
        var slogan = $(".PageTitle h3").text();
        $(".PageTitle h3").text("");
        var a = 0;

        function typingSlogan() {
            if (a == slogan.length) {
                clearInterval(interval);
                setTimeout(function () {
                    a = 1;
                    $(".PageTitle h3").animate({ opacity: 0 }, "fast");
                    setTimeout(function () {
                        $(".PageTitle h3").css("opacity", 1).text(slogan.substr(0, 1));
                        interval = setInterval(typingSlogan, 20);
                    }, 1000);
                }, 4000);
            }
            $(".PageTitle h3").append(slogan.substr(a, 1))
            a++;
        }
        var interval = setInterval(typingSlogan, 20)

    }
    animateSlogan();

    $('.magnificCarousel').magnificPopup({
        delegate: 'a',
        type: 'image',
        gallery: {
            enabled: true
        },
    });

    $("#header .navbar-nav .nav-item").hover(function () {
        $(this).css("overflow", "visible");
        var height = $(this).children("ul").children("li").length * ($(this).children("ul").children("li").height() + 5) + 40;
        if (!isNaN(height)) {
            $("#overlay-navbar").addClass("active");
        }
        if ($(this).has("div.aaa").length > 0) {

            $("#overlay-navbar").addClass("active");

            var maxListCount = 0;
            var maxListItem;
            for (var itemList of $(this).find(".aaa .item")) {
                if ($(itemList).find("ul li").length > maxListCount) {
                    maxListCount = $(itemList).find("ul li").length;
                    maxListItem = $(itemList);
                }
            }

            var itemHeight = maxListItem.children("ul").children("li").length * (maxListItem.children("ul").children("li").height() + 5) + 1;
            $(this).find(".aaa .item").css("height", itemHeight);

            var itemWrapperHeight = Math.ceil($(this).find(".aaa > div").children(".item").length / 3) * ($(this).find(".aaa > div").children(".item").height() + 50) + 1;
            $(this).find(".aaa > div:first-child").css("height", itemWrapperHeight);

            $(this).find(".aaa").css("height", itemWrapperHeight).addClass("border border-dark");
            return;
        }
        $(this).children("ul").css("height", height);
        $(this).children('ul').css("border", '1px solid black');
    });

    $("#header .navbar-nav .nav-item").mouseleave(function () {
        $("#overlay-navbar").removeClass("active");
        $(this).css("overflow", "hidden");

        // var height = $(this).children("ul").children("li").length * ($(this).children("ul").children("li").height() + 5) + 1;
        $(this).children("ul").css("height", 0);
        $(".aaa").css("height", 0).removeClass("border border-dark py-3");
        $(this).children('ul').css("border", 'none');

    })

    //height basket-box and search-box
    function basketAndSearchHeight() {
        if ($(document).width() <= 992) {
            $(".black-box").removeAttr("style");
            return
        }
        var height = $(window).height() - $("#header").height();
        $(".black-box").css("height", height);

    }
    basketAndSearchHeight();

    function navbarIconsWidth() {
        if ($(document).width() > 992) {
            $("#header").css("position", "fixed");
            $(".wrapper").css("margin-top", 172);
        } else {
            $("#header").css("position", "static");
            $(".wrapper").css("margin-top", 0);
        }
    }
    navbarIconsWidth();

    // check filter clithings section
    function CheckFilterSection() {
        if ($(document).width() <= 576 && $(".toggle-filter").hasClass("active")) {
            $(".toggle-filter").click();
        }
    }
    CheckFilterSection();

    window.onresize = function () {
        navbarIconsWidth();
        basketAndSearchHeight();
        CheckFilterSection();
    }

    $("nav").click(function () {
        $(this).children(".custom-dropdown-menu").toggleClass("active");
    })

    //change modal between sing in and sing up
    $(".modal [modalname]").click(function () {
        $(".modal").modal("hide");
        $($(this).attr("modalname")).modal("show");
        // alert($(this).attr("modalname"));
    });

    //close box when click others

    // LOL
    $(document).click(function (e) {
        if (!$(e.target).closest("header .black-box, .show-search-box, .show-basket-box").length) {
            $("header .black-box").fadeOut();
        }
    });

    //ajax for write review
    $(".product .gray-box .btn-add-card").click(function (e) {
        e.preventDefault();
        var a = "";
        $(".product .gray-box .form-group-custom .form-control-custom").css("border-color", "#979a9d").each(function () {
            if ($(this).val() == "") {
                a += $(this).attr("placeholder").substr(0, $(this).attr("placeholder").length - 1) + ", ";
                $(this).css("border-color", "red");
            }
        })
        //if (a != "") {
        //    $("#addToCard .modal-header h5").text("Write input").parent().removeClass("bg-success bg-danger").addClass("bg-warning").siblings(".modal-body").text("Please write " + a.substr(0, a.length - 2) + " input");
        //    $("#addToCard").modal("show");
        //    return;
        //}

        $.ajax({
            url: "",
            type: "post",
            dataType: "json",
            success: (function (response) {
                //if( success ok){
                // $("#addToCard .modal-content .modal-header h5").text("Completed").parent().addClass("bg-success").removeClass("bg-warning bg-danger").siblings(".modal-body").text("Thanks you for your reviews!");
                //$("#addToCard").modal("show");
                // $(".product .gray-box .form-group-custom .form-control-custom").val("")                
                //return;
                //}

                //if (users error){
                //$("#addToCard .modal-header h5").text("Write input").parent().removeClass("bg-success bg-danger").addClass("bg-warning").siblings(".modal-body").text("Please write "+a.substr(0, a.length-2)+" input");
                //$("#addToCard").modal("show");
                //}
            }),
            error: (function (error) {
                //$("#addToCard .modal-content .modal-header h5").text("Error").parent().removeClass("bg-success bg-warning").addClass("bg-danger").siblings(".modal-body").text("Server error");
                //$("#addToCard").modal("show");
            })
        })

    })

    //$(".btn-delete-address").click(function () {
    //    $(".address-info-box").removeClass("border border-danger");
    //    $(this).parents(".address-info-box").addClass("border border-danger")
    //})

    ////ajax for delete address
    //$("#delete-address .btn-danger").click(function () {
    //    $("#delete-address").modal("hide");
    //    var id = $(".address-info-box.border-danger").attr("id");
    //    $(".address-info-box.border-danger").fadeOut();
    //    $("#info-delete-address .modal-content .modal-header h5").text("Deleted").parent().removeClass("bg-danger").addClass("bg-success").siblings(".modal-body").text("The address has been deleted");
    //    setTimeout(function () {
    //        $("#info-delete-address").modal("show");
    //    }, 700)
    //    $.ajax({
    //        url: "",
    //        data: id,
    //        type: "get",
    //        dataType: "json",
    //        success: (function (response) {
    //        }),
    //        error: (function (error) {
    //            $("#info-delete-address .modal-content .modal-header h5").text("Error").parent().removeClass("bg-success").addClass("bg-danger").siblings(".modal-body").text("Server error");
    //            $("#info-delete-address").modal("show");
    //        })
    //    })
    //})


    //animate when ajax working 
    $(document).ajaxStart(function () {
        $("body").css("opacity", "0.8");
        $("#divAjaxMain").css("display", "block");
    });
    $(document).ajaxComplete(function () {
        $("body").css("opacity", "1.0");
        $("#divAjaxMain").css("display", "none");
    });


    $(".custom-dropdown-menu .nav-link").click(function () {
        window.location.href = $(this).attr("href");
    })
});

let prevPos = window.pageYOffset
let navbarEl = document.querySelector('.navbar')
window.addEventListener('scroll', e => {
    let currentPos = window.pageYOffset
    if (currentPos < prevPos) {
        navbarEl.style.padding = '10px 0'
        $(".navbar-nav ul").addClass("scrolled");
        $(".navbar-nav .aaa").addClass("scrolled");
    }
    else if (currentPos >= prevPos) { navbarEl.style.padding = '40px 0' }
    if (currentPos === 0) {
        navbarEl.style.padding = '40px 0'
        $(".navbar-nav ul").removeClass("scrolled");
        $(".navbar-nav .aaa").removeClass("scrolled");
    }
    prevPos = currentPos
})

//Mobile menu design

let blurryBg = document.createElement('div');
blurryBg.classList.add('blurry-bg')
blurryBg.addEventListener('click', e => {
    e.currentTarget.remove();
    let openMenus = document.querySelectorAll('.left-menu-open');
    openMenus.forEach(item => {
        item.classList.remove('left-menu-open')
    })
    document.body.style.overflow = 'auto';
})
let burgerbtn = document.querySelector('.burger-btn');
burgerbtn.addEventListener('click', e => {
    document.querySelector('.collapse.navbar-collapse').classList.add('left-menu-open')
    if (!document.querySelector('.blurry-bg')) {
        document.body.append(blurryBg)
        document.body.style.overflow = 'hidden';
    }
})
let burgerCloseBtn = document.querySelector('.burger-menu-close-btn');
burgerCloseBtn.addEventListener('click', e => {
    let openMenus = document.querySelectorAll('.left-menu-open');
    openMenus.forEach(item => {
        item.classList.remove('left-menu-open')
    })
    document.querySelector('.blurry-bg').remove();
    document.body.style.overflow = 'auto'
})
let navItems = document.querySelectorAll('.nav-item');
let navSubmenuBackBtns = document.querySelectorAll('.nav-item-submenu-back-btn');
navSubmenuBackBtns.forEach(item => {
    item.addEventListener('click', e => {
        e.stopPropagation()

        e.currentTarget.parentElement.parentElement.classList.remove('left-menu-open')
    })
})
navItems.forEach(item => {
    if (item.querySelector('.nav-item-submenu')) {
        item.addEventListener('click', e => {
            item.querySelector('.nav-item-submenu').classList.add('left-menu-open')
        })
    }
})

if (screen.width <= 992) {
    $(".nav-link").click(function (e) {
        if ($(this).parent(".nav-item").hasClass("with-sub-menu"))
            e.preventDefault();
    });
}


$(".black-box.search-box").click(function (e) {
    e.stopPropagation();
})

if (document.querySelector('.filter-clothing-top')) {
    document.querySelector('.filter-clothing-top').addEventListener('click', e => {
        document.querySelector('.clothing .filter-clothing').classList.toggle('active')
    })
}




$(document).on("click", ".modal-btn", function () {
    $(this).parents(".custom-modal-wrapper").removeClass("active");
})


if (window.screen.width <= 576) {
    if ($(".btn-gender").length > 0) {
        $(".btn-gender").addClass("no-before");
    }
}

$(window).resize(function () {
    if (window.screen.width > 576) {
        if ($(".btn-gender").length > 0) {
            $(".btn-gender").removeClass("no-before");
        }
    }
    else {
        if ($(".btn-gender").length <= 576) {
            $(".btn-gender").addClass("no-before");
        }
    }
});
